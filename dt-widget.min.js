!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.ChatWidget=t()}(this,function(){"use strict";var e=function(){var e=document.getElementsByTagName("script"),t=e[e.length-1].src.replace("dt-widget.js","").replace("dt-widget.min.js","");return t},t=e(),i=function(){this.getScriptUrl=function(){return t},this.loadCSS=function(e,t){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",e),i.onreadystatechange=i.onload=function(){t.done||i.readyState&&!/loaded|complete/.test(i.readyState)||(t.done=!0,t())},document.querySelector("head").appendChild(i)},this.loadScript=function(e,t){var i=document.createElement("script");i.src=e,i.async=!0,i.onreadystatechange=i.onload=function(){t.done||i.readyState&&!/loaded|complete/.test(i.readyState)||(t.done=!0,t())},document.querySelector("head").appendChild(i)},this.$setValid=function(e){e.className=e.className.replace(" dt-valid",""),e.className=e.className.replace(" dt-invalid",""),e.className+=" dt-valid",e.$valid=!0,e.$invalid=!1},this.$setInvalid=function(e){e.className=e.className.replace(" dt-invalid",""),e.className=e.className.replace(" dt-valid",""),e.className+=" dt-invalid",e.$valid=!1,e.$invalid=!0},this.URL=this.getScriptUrl()};return i.prototype.create=function(e){return e.useMask===!0&&"undefined"==typeof VMasker?(this.loadScript(this.URL+"/vendors/vanilla-masker.min.js",function(){this.create(e)}.bind(this)),!1):(this.widget=document.createElement("div"),this.widget.className="dt-chat-widget",this.widget.header=document.createElement("div"),this.widget.subheader=document.createElement("div"),this.widget.body=document.createElement("div"),this.widget.footer=document.createElement("div"),this.widget.body.customText=document.createElement("p"),this.widget.body.customText.innerHTML=e.customText,this.widget.body.appendChild(this.widget.body.customText),this.widget.appendChild(this.widget.header),this.widget.appendChild(this.widget.subheader),this.widget.appendChild(this.widget.body),this.widget.appendChild(this.widget.footer),this.widget.header.className="dt-chat-widget-header",this.widget.subheader.className="dt-chat-widget-subheader",this.widget.body.className="dt-chat-widget-body",this.widget.footer.className="dt-chat-widget-footer",this.widget.header.innerHTML=e.title,this.widget.header.onclick=this.toggle.bind(this),this.widget.body.form=document.createElement("form"),this.widget.body.appendChild(this.widget.body.form),this.widget.body.form.name="dt-widget-form",this.widget.body.form.onsubmit=this.submitForm.bind(this),this.widget.body.form.noValidate=!0,this.fields=e.fields,this.chatURL=e.chatURL,this.fields.forEach(function(e){this.createInput(e,this.widget.body.form)},this),this.widget.body.form.button=document.createElement("button"),this.widget.body.form.button.innerHTML=e.buttonText,this.widget.body.form.appendChild(this.widget.body.form.button),this.widget.body.form.button.type="submit",this.loadCSS(e.css,function(){document.body.appendChild(this.widget),"undefined"!=typeof e.closed&&e.closed!==!0||this.close()}.bind(this)),"function"==typeof this.oncreate&&this.oncreate(),void(e.customHtml&&e.customHtml.forEach(function(e){this.addCustomHtml(e.element,e.content)},this)))},i.prototype.createInput=function(e,t){var i,d=document.createElement("div"),o=document.createElement("label");"text"===e.type||"number"===e.type||"email"===e.type||"hidden"===e.type?(i=document.createElement("input"),i.type=e.type):"select"===e.type?(i=document.createElement("select"),e.options.unshift({name:"Selecione",value:""}),e.options.forEach(function(e){var t=document.createElement("option");t.text=e.name,t.value=e.value,i.appendChild(t)})):"textarea"===e.type?i=document.createElement("textarea"):(i=document.createElement("input"),i.type="text"),e.placeholder&&(i.placeholder=e.placeholder),"undefined"!=typeof e.mask&&VMasker(i).maskPattern(e.mask),i.className="dt-input-control",o.className="dt-label-control",d.className="dt-chat-widget-form-control",d.appendChild(o),d.appendChild(i),o.innerHTML=e.label||"",i.required=e.required,i.name=e.name,e.value&&(i.value=e.value),t.appendChild(d)},i.prototype.submitForm=function(e){e.preventDefault();var t=!0,i="";this.fields.forEach(function(e){var d,o;e.mask&&(o=VMasker.toNumber(this.widget.body.form[e.name].value)),d=o||this.widget.body.form[e.name].value,i+="&"+e.name+"="+d,e.required?(this.validateRequired(this.widget.body.form[e.name])||(t=!1),"email"!==e.type||this.validateEmail(this.widget.body.form[e.name])||(t=!1)):this.$setValid(this.widget.body.form[e.name])},this),t?this.$setValid(this.widget.body.form):this.$setInvalid(this.widget.body.form),this.widget.body.form.$invalid||window.open(this.chatURL+i,"Popup","width=480,height=520"),"function"==typeof this.onsubmit&&this.onsubmit()},i.prototype.validateRequired=function(e){return""===e.value||"undefined"==typeof e.value||null===e.value?(this.$setInvalid(e),!1):(this.$setValid(e),!0)},i.prototype.validateEmail=function(e){var t=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;return"undefined"!=typeof e.value&&t.test(e.value)&&""!==e.value?(this.$setValid(e),!0):(this.$setInvalid(e),!1)},i.prototype.setTimer=function(e){setTimeout(function(){this.open()}.bind(this),1e3*e)},i.prototype.open=function(){this.widget.body.style.display="block",this.widget.subheader.style.display="block",this.widget.footer.style.display="block",this.widget.className=this.widget.className.replace(" open",""),this.widget.className=this.widget.className.replace(" closed",""),this.widget.className+=" open","function"==typeof this.onopen&&this.onopen()},i.prototype.close=function(){this.widget.body.style.display="none",this.widget.subheader.style.display="none",this.widget.footer.style.display="none",this.widget.className=this.widget.className.replace(" closed",""),this.widget.className=this.widget.className.replace(" open",""),this.widget.className+=" closed","function"==typeof this.onclose&&this.onclose()},i.prototype.toggle=function(){"none"===this.widget.body.style.display?this.open():this.close(),"function"==typeof this.ontoggle&&this.ontoggle()},i.prototype.addCustomHtml=function(e,t){var i;switch(e){case"footer":i=this.widget.footer;break;case"header":i=this.widget.subheader}t&&(i.innerHTML=t)},i.prototype.oncreate=function(){},i.prototype.onsubmit=function(){},i.prototype.onopen=function(){},i.prototype.ontoggle=function(){},i.prototype.onclose=function(){},i});