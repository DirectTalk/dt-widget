!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.ChatWidget=e()}(this,function(){"use strict";var t,e=(t=document.getElementsByTagName("script"))[t.length-1].src.replace("dt-widget.js","").replace("dt-widget.min.js",""),i=function(){this.getScriptUrl=function(){return e},this.loadCSS=function(t,e){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",t),i.onreadystatechange=i.onload=function(){e.done||i.readyState&&!/loaded|complete/.test(i.readyState)||(e.done=!0,e())},document.querySelector("head").appendChild(i)},this.loadScript=function(t,e){var i=document.createElement("script");i.src=t,i.async=!0,i.onreadystatechange=i.onload=function(){e.done||i.readyState&&!/loaded|complete/.test(i.readyState)||(e.done=!0,e())},document.querySelector("head").appendChild(i)},this.$setValid=function(t){t.className=t.className.replace(" dt-valid",""),t.className=t.className.replace(" dt-invalid",""),t.className+=" dt-valid",t.$valid=!0,t.$invalid=!1},this.$setInvalid=function(t){t.className=t.className.replace(" dt-invalid",""),t.className=t.className.replace(" dt-valid",""),t.className+=" dt-invalid",t.$valid=!1,t.$invalid=!0},this.URL=this.getScriptUrl(),this.HAS_INIT=!1};return i.prototype.create=function(t){if(!0===t.useMask&&"undefined"==typeof VMasker)return this.loadScript("https://www3.directtalk.com.br/clientes/custom/DirectTalk/widget/vendors/vanilla-masker.min.js",function(){this.create(t)}.bind(this)),!1;this.useChatWidget=t.useChatWidget,this.widget=document.createElement("div"),this.widget.className="dt-chat-widget",this.widget.header=document.createElement("div"),this.widget.subheader=document.createElement("div"),this.widget.body=document.createElement("div"),this.widget.footer=document.createElement("div"),this.widget.body.customText=document.createElement("p"),this.widget.body.customText.innerHTML=t.customText,this.widget.body.appendChild(this.widget.body.customText),this.widget.appendChild(this.widget.header),this.widget.appendChild(this.widget.subheader),this.widget.appendChild(this.widget.body),this.widget.appendChild(this.widget.footer),this.widget.header.className="dt-chat-widget-header",this.widget.subheader.className="dt-chat-widget-subheader",this.widget.body.className="dt-chat-widget-body",this.widget.footer.className="dt-chat-widget-footer",this.widget.header.innerHTML=t.title,this.widget.header.onclick=this.toggle.bind(this),this.widget.body.form=document.createElement("form"),this.widget.body.appendChild(this.widget.body.form),this.widget.body.form.name="dt-widget-form",this.widget.body.form.onsubmit=this.submitForm.bind(this),this.widget.body.form.noValidate=!0,this.fields=t.fields,this.chatURL=t.chatURL,this.fields.forEach(function(t){this.createInput(t,this.widget.body.form)},this),this.widget.body.form.button=document.createElement("button"),this.widget.body.form.button.innerHTML=t.buttonText,this.widget.body.form.appendChild(this.widget.body.form.button),this.widget.body.form.button.type="submit",this.loadCSS(t.css,function(){document.body.appendChild(this.widget),void 0!==t.closed&&!0!==t.closed||this.close()}.bind(this)),"function"==typeof this.oncreate&&this.oncreate(),t.customHtml&&t.customHtml.forEach(function(t){this.addCustomHtml(t.element,t.content)},this)},i.prototype.createInput=function(t,e){var i,d=document.createElement("div"),s=document.createElement("label");if("text"===t.type||"number"===t.type||"email"===t.type||"hidden"===t.type)(i=document.createElement("input")).type=t.type;else if("select"===t.type||"init"===t.type){if("init"===t.type){if(this.HAS_INIT)return void console.error('The field "'+t.name+'" cannot be set because the widget already has a "init" type field');this.HAS_INIT=!0}i=document.createElement("select"),t.options.unshift({name:"Selecione",value:""}),t.options.forEach(function(t){var e=document.createElement("option");e.text=t.name,e.value=t.value,i.appendChild(e)})}else"textarea"===t.type?i=document.createElement("textarea"):(i=document.createElement("input")).type="text";t.placeholder&&(i.placeholder=t.placeholder),void 0!==t.mask&&VMasker(i).maskPattern(t.mask),i.className="dt-input-control",s.className="dt-label-control",d.className="dt-chat-widget-form-control",d.appendChild(s),d.appendChild(i),s.innerHTML=t.label||"",i.required=t.required,i.name=t.name,t.value&&(i.value=t.value),e.appendChild(d)},i.prototype.submitForm=function(t){t.preventDefault();var e,i,d,s,o=!0,a="";this.fields.forEach(function(t){var i,d;"init"===t.type?e=this.widget.body.form[t.name].value:(t.mask&&(d=VMasker.toNumber(this.widget.body.form[t.name].value)),i=d||this.widget.body.form[t.name].value,a+="&"+t.name+"="+i,t.required?(this.validateRequired(this.widget.body.form[t.name])||(o=!1),"email"!==t.type||this.validateEmail(this.widget.body.form[t.name])||(o=!1)):this.$setValid(this.widget.body.form[t.name]))},this),this.chatURL=this.HAS_INIT&&""!==e?e:this.chatURL,o?this.$setValid(this.widget.body.form):this.$setInvalid(this.widget.body.form),this.widget.body.form.$invalid||this.useChatWidget||window.open(this.chatURL+a,"Popup","width=480,height=520"),this.useChatWidget&&(i=e,d=a,(s=document.createElement("script")).id="hi-chat-script",s.src="https://chat.directtalk.com.br/static/hi-chat/chat.js?widgetId="+i+"&callback=hiChatCallback",document.querySelector("body").append(s),window.hiChatCallback=function(){document.querySelector(".dt-chat-widget").style.display="none";var t=d;t=t.substring(1,t.length-1),window.Hi.Chat.minimize(),window.Hi.Chat.fillSurvey(t),window.Hi.Chat.start()}),"function"==typeof this.onsubmit&&this.onsubmit()},i.prototype.validateRequired=function(t){return""===t.value||void 0===t.value||null===t.value?(this.$setInvalid(t),!1):(this.$setValid(t),!0)},i.prototype.validateEmail=function(t){return void 0!==t.value&&/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(t.value)&&""!==t.value?(this.$setValid(t),!0):(this.$setInvalid(t),!1)},i.prototype.setTimer=function(t){setTimeout(function(){this.open()}.bind(this),1e3*t)},i.prototype.open=function(){this.widget.body.style.display="block",this.widget.subheader.style.display="block",this.widget.footer.style.display="block",this.widget.className=this.widget.className.replace(" open",""),this.widget.className=this.widget.className.replace(" closed",""),this.widget.className+=" open","function"==typeof this.onopen&&this.onopen()},i.prototype.close=function(){this.widget.body.style.display="none",this.widget.subheader.style.display="none",this.widget.footer.style.display="none",this.widget.className=this.widget.className.replace(" closed",""),this.widget.className=this.widget.className.replace(" open",""),this.widget.className+=" closed","function"==typeof this.onclose&&this.onclose()},i.prototype.toggle=function(){"none"===this.widget.body.style.display?this.open():this.close(),"function"==typeof this.ontoggle&&this.ontoggle()},i.prototype.addCustomHtml=function(t,e){var i;switch(t){case"footer":i=this.widget.footer;break;case"header":i=this.widget.subheader}e&&(i.innerHTML=e)},i.prototype.oncreate=function(){},i.prototype.onsubmit=function(){},i.prototype.onopen=function(){},i.prototype.ontoggle=function(){},i.prototype.onclose=function(){},i});
