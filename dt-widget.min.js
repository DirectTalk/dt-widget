(function(f,c){"function"===typeof define&&define.amd?define(c):"object"===typeof exports?module.exports=c():f.ChatWidget=c()})(this,function(){var f=function(){var a=document.getElementsByTagName("script");return a[a.length-1].src.replace("dt-widget.js","").replace("dt-widget.min.js","")}(),c=function(){this.getScriptUrl=function(){return f};this.loadCSS=function(a,e){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);
b.onreadystatechange=b.onload=function(){e.done||b.readyState&&!/loaded|complete/.test(b.readyState)||(e.done=!0,e())};document.querySelector("head").appendChild(b)};this.loadScript=function(a,e){var b=document.createElement("script");b.src=a;b.async=!0;b.onreadystatechange=b.onload=function(){e.done||b.readyState&&!/loaded|complete/.test(b.readyState)||(e.done=!0,e())};document.querySelector("head").appendChild(b)};this.$setValid=function(a){a.className=a.className.replace(" dt-valid","");a.className=
a.className.replace(" dt-invalid","");a.className+=" dt-valid";a.$valid=!0;a.$invalid=!1};this.$setInvalid=function(a){a.className=a.className.replace(" dt-invalid","");a.className=a.className.replace(" dt-valid","");a.className+=" dt-invalid";a.$valid=!1;a.$invalid=!0};this.URL=this.getScriptUrl()};c.prototype.create=function(a){if(!0===a.useMask&&"undefined"===typeof VMasker)return this.loadScript(this.URL+"/vendors/vanilla-masker.min.js",function(){this.create(a)}.bind(this)),!1;this.widget=document.createElement("div");
this.widget.className="dt-chat-widget";this.widget.header=document.createElement("div");this.widget.body=document.createElement("div");this.widget.body.customText=document.createElement("p");this.widget.body.customText.innerHTML=a.customText;this.widget.body.appendChild(this.widget.body.customText);this.widget.appendChild(this.widget.header);this.widget.appendChild(this.widget.body);this.widget.header.className="dt-chat-widget-header";this.widget.body.className="dt-chat-widget-body";this.widget.header.innerHTML=
a.title;this.widget.header.onclick=this.toggle.bind(this);this.widget.body.form=document.createElement("form");this.widget.body.appendChild(this.widget.body.form);this.widget.body.form.name="dt-widget-form";this.widget.body.form.onsubmit=this.submitForm.bind(this);this.widget.body.form.noValidate=!0;this.fields=a.fields;this.chatURL=a.chatURL;this.fields.forEach(function(a){this.createInput(a,this.widget.body.form)},this);this.widget.body.form.button=document.createElement("button");this.widget.body.form.button.innerHTML=
a.buttonText;this.widget.body.form.appendChild(this.widget.body.form.button);this.widget.body.form.button.type="submit";this.loadCSS(a.css,function(){document.body.appendChild(this.widget);"undefined"!==typeof a.closed&&!0!==a.closed||this.close()}.bind(this))};c.prototype.createInput=function(a,e){var b=document.createElement("div"),c=document.createElement("label"),d;"text"===a.type||"number"===a.type||"email"===a.type||"hidden"===a.type?(d=document.createElement("input"),d.type=a.type):"select"===
a.type?(d=document.createElement("select"),a.options.unshift({name:"Selecione",value:""}),a.options.forEach(function(a){var b=document.createElement("option");b.text=a.name;b.value=a.value;d.appendChild(b)})):"textarea"===a.type?d=document.createElement("textarea"):(d=document.createElement("input"),d.type="text");a.placeholder&&(d.placeholder=a.placeholder);"undefined"!==typeof a.mask&&VMasker(d).maskPattern(a.mask);d.className="dt-input-control";c.className="dt-label-control";b.className="dt-chat-widget-form-control";
b.appendChild(c);b.appendChild(d);c.innerHTML=a.label||"";d.required=a.required;d.name=a.name;a.value&&(d.value=a.value);e.appendChild(b)};c.prototype.submitForm=function(a){a.preventDefault();var c=!0,b="";this.fields.forEach(function(a){var d;a.mask&&(d=VMasker.toNumber(this.widget.body.form[a.name].value));b+="&"+a.name+"="+(d||this.widget.body.form[a.name].value);a.required?(this.validateRequired(this.widget.body.form[a.name])||(c=!1),"email"!==a.type||this.validateEmail(this.widget.body.form[a.name])||
(c=!1)):this.$setValid(this.widget.body.form[a.name])},this);c?this.$setValid(this.widget.body.form):this.$setInvalid(this.widget.body.form);this.widget.body.form.$invalid||window.open(this.chatURL+b,"Popup","width=480,height=520")};c.prototype.validateRequired=function(a){if(""===a.value||"undefined"===typeof a.value||null===a.value)return this.$setInvalid(a),!1;this.$setValid(a);return!0};c.prototype.validateEmail=function(a){var c=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
if("undefined"!==typeof a.value&&c.test(a.value)&&""!==a.value)return this.$setValid(a),!0;this.$setInvalid(a);return!1};c.prototype.setTimer=function(a){setTimeout(function(){this.open()}.bind(this),1E3*a)};c.prototype.open=function(){this.widget.body.style.display="block";this.widget.className=this.widget.className.replace(" open","");this.widget.className=this.widget.className.replace(" closed","");this.widget.className+=" open"};c.prototype.close=function(){this.widget.body.style.display="none";
this.widget.className=this.widget.className.replace(" closed","");this.widget.className=this.widget.className.replace(" open","");this.widget.className+=" closed"};c.prototype.toggle=function(){"none"===this.widget.body.style.display?this.open():this.close()};return c});
